name: Build LaTeX - Pull Request

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  build-pr:
    uses: ./.github/workflows/build-latex.yml
    with:
      environment: dev
      artifact_suffix: -pr-${{ github.event.number }}
      upload_to_gcs: false
      gcs_destination_path: ''
    secrets:
      AUTH_PROVIDER: ${{ secrets.AUTH_PROVIDER }}
      SERVICE_ACCOUNT: ${{ secrets.SERVICE_ACCOUNT }}
      BUCKET_NAME: ${{ secrets.BUCKET_NAME }}

  comment-pr:
    needs: build-pr
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Find existing comment
        uses: peter-evans/find-comment@v3
        id: find-comment
        with:
          issue-number: ${{ github.event.number }}
          comment-author: 'github-actions[bot]'
          body-includes: 'üìÑ LaTeX Build Artifacts'

      - name: Create or update PR comment
        uses: peter-evans/create-or-update-comment@v4
        with:
          comment-id: ${{ steps.find-comment.outputs.comment-id }}
          issue-number: ${{ github.event.number }}
          edit-mode: replace
          body: |
            ## üìÑ LaTeX Build Artifacts
            
            Your LaTeX documents have been compiled successfully! You can download them here:
            
            | Document | Download Link |
            |----------|---------------|
            | CV | [View Artifacts](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |
            | Resume | [View Artifacts](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |
            | Portfolio | [View Artifacts](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |
            
            **Artifact Names:**
            - `cv-gabriel-faundez-pr-${{ github.event.number }}.pdf`
            - `resume-gabriel-faundez-pr-${{ github.event.number }}.pdf`
            - `portfolio-gabriel-faundez-pr-${{ github.event.number }}.pdf`
            
            > üí° Click "View Artifacts" above, then scroll down to the "Artifacts" section to download.
            
            <details>
            <summary>üîç How to download artifacts</summary>
            
            1. Click on "View Artifacts" link above
            2. Scroll down to the "Artifacts" section
            3. Click on the artifact name to download the ZIP file
            4. Extract the ZIP to get your PDF
            </details>
            
            ---
            *This comment will be updated when you push new changes to this PR.*
